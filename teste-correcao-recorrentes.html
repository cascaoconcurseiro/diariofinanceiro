<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Corre√ß√£o Lan√ßamentos Recorrentes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste: Corre√ß√£o de Lan√ßamentos Recorrentes</h1>
        
        <div class="test-section info">
            <h3>üìÖ Cen√°rio de Teste</h3>
            <p><strong>Data atual:</strong> <span id="currentDate"></span></p>
            <p><strong>Problema:</strong> Lan√ßamentos recorrentes criados para dias que j√° passaram</p>
            <p><strong>Solu√ß√£o:</strong> Calcular sempre a pr√≥xima data v√°lida (futura)</p>
        </div>

        <div class="test-section">
            <h3>üîß Testes de Corre√ß√£o</h3>
            
            <button onclick="testPastDay()">Testar Dia que J√° Passou</button>
            <button onclick="testFutureDay()">Testar Dia Futuro</button>
            <button onclick="testDay31()">Testar Dia 31 (Ajuste)</button>
            <button onclick="testMultipleDates()">Testar M√∫ltiplas Datas</button>
            <button onclick="clearLog()">Limpar Log</button>
            
            <div id="testLog" class="log"></div>
        </div>

        <div class="test-section">
            <h3>üìä Resultados dos Testes</h3>
            <div id="testResults"></div>
        </div>
    </div>

    <script>
        // Simular as fun√ß√µes do utilit√°rio de c√°lculo de datas
        function calculateNextRecurringDate(options) {
            const { dayOfMonth } = options;
            const today = new Date();
            const currentDay = today.getDate();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            let nextDate = new Date(currentYear, currentMonth, dayOfMonth);
            
            // Se o dia j√° passou no m√™s atual, ir para o pr√≥ximo m√™s
            if (dayOfMonth <= currentDay) {
                nextDate.setMonth(nextDate.getMonth() + 1);
                log(`üìÖ CORRE√á√ÉO: Dia ${dayOfMonth} j√° passou este m√™s, pr√≥xima execu√ß√£o em ${nextDate.toLocaleDateString()}`);
            } else {
                log(`üìÖ OK: Dia ${dayOfMonth} ainda n√£o chegou este m√™s, execu√ß√£o em ${nextDate.toLocaleDateString()}`);
            }
            
            // Ajustar para meses que n√£o t√™m o dia especificado
            if (nextDate.getDate() !== dayOfMonth) {
                nextDate = new Date(nextDate.getFullYear(), nextDate.getMonth() + 1, 0);
                log(`üìÖ AJUSTE: Dia ${dayOfMonth} n√£o existe no m√™s, usando √∫ltimo dia: ${nextDate.getDate()}`);
            }
            
            return nextDate;
        }

        function isValidRecurringDate(date) {
            const today = new Date();
            const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            return date >= todayStart;
        }

        function log(message) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').textContent = '';
        }

        function updateResults(testName, passed) {
            const resultsElement = document.getElementById('testResults');
            const status = passed ? '‚úÖ PASSOU' : '‚ùå FALHOU';
            const className = passed ? 'success' : 'error';
            
            resultsElement.innerHTML += `
                <div class="test-section ${className}">
                    <strong>${testName}:</strong> ${status}
                </div>
            `;
        }

        function testPastDay() {
            log('\nüß™ TESTE 1: Dia que j√° passou');
            const today = new Date();
            const pastDay = Math.max(1, today.getDate() - 5);
            
            log(`Hoje: ${today.toLocaleDateString()}`);
            log(`Dia solicitado: ${pastDay}`);
            
            const nextDate = calculateNextRecurringDate({ dayOfMonth: pastDay });
            const isValid = isValidRecurringDate(nextDate);
            
            log(`Pr√≥xima execu√ß√£o: ${nextDate.toLocaleDateString()}`);
            log(`√â v√°lida (futura): ${isValid}`);
            
            updateResults('Dia que j√° passou', isValid);
        }

        function testFutureDay() {
            log('\nüß™ TESTE 2: Dia futuro');
            const today = new Date();
            const futureDay = Math.min(31, today.getDate() + 5);
            
            log(`Hoje: ${today.toLocaleDateString()}`);
            log(`Dia solicitado: ${futureDay}`);
            
            const nextDate = calculateNextRecurringDate({ dayOfMonth: futureDay });
            const isValid = isValidRecurringDate(nextDate);
            
            log(`Pr√≥xima execu√ß√£o: ${nextDate.toLocaleDateString()}`);
            log(`√â v√°lida (futura): ${isValid}`);
            
            updateResults('Dia futuro', isValid);
        }

        function testDay31() {
            log('\nüß™ TESTE 3: Dia 31 (ajuste autom√°tico)');
            
            const nextDate = calculateNextRecurringDate({ dayOfMonth: 31 });
            const isValid = isValidRecurringDate(nextDate);
            
            log(`Dia solicitado: 31`);
            log(`Pr√≥xima execu√ß√£o: ${nextDate.toLocaleDateString()}`);
            log(`Dia ajustado: ${nextDate.getDate()}`);
            log(`√â v√°lida (futura): ${isValid}`);
            
            updateResults('Dia 31 (ajuste)', isValid);
        }

        function testMultipleDates() {
            log('\nüß™ TESTE 4: M√∫ltiplas datas');
            const testDays = [1, 15, 28, 31];
            let allValid = true;
            
            testDays.forEach(day => {
                const nextDate = calculateNextRecurringDate({ dayOfMonth: day });
                const isValid = isValidRecurringDate(nextDate);
                
                log(`Dia ${day}: ${nextDate.toLocaleDateString()} - ${isValid ? 'V√ÅLIDA' : 'INV√ÅLIDA'}`);
                
                if (!isValid) allValid = false;
            });
            
            updateResults('M√∫ltiplas datas', allValid);
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('pt-BR');
            log('üöÄ Sistema de teste carregado');
            log('üìã Clique nos bot√µes para executar os testes');
        });
    </script>
</body>
</html>